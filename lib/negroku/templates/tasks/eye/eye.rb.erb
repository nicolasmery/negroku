# Eye self-configuration section
Eye.config do
  logger '<%= fetch(:shared_path)%>/log/eye.log'
end

# Adding application
Eye.application '<%= fetch(:application)%>' do

  # All options inherits down to the config leafs.
  # except `env`, which merging down

  working_dir File.expand_path(File.join(File.dirname(__FILE__), %w[ processes ]))
  stdall '<%= fetch(:shared_path)%>/log/trash.log' # stdout,err logs for processes by default
  env 'APP_ENV' => '<%= fetch(:rails_env)%>' # global env for each processes
  trigger :flapping, times: 10, within: 1.minute, retry_in: 10.minutes
  check :cpu, every: 10.seconds, below: 100, times: 3 # global check for all processes

<% processes.each do |process, options| -%>
<%= partial 'tasks/eye/_process.rb.erb', binding %>
<% end -%>
end
